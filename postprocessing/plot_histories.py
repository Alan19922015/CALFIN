# -*- coding: utf-8 -*-
"""
Created on Sun Jun  9 18:06:26 2019

@author: Daniel
"""

import matplotlib.pyplot as plt
import numpy as np
import sys, cv2
import error_analysis
from plotting import plot_validation_results
sys.path.insert(1, '../training/keras-deeplab-v3-plus')
sys.path.insert(2, '../training')

from processing import reprocess, calculate_mean_deviation, calculate_edge_iou

if __name__ == '__main__':
	
	history = {'val_loss': [3.263788972493091, 2.900044510411281, 2.7173366334703233, 2.5965566660064496, 2.5223864120595594, 2.443304773249657, 2.363702654682733, 2.3454859256744385, 2.31089665344338, 2.243784012202344, 2.202782677513322, 2.217862319634631, 2.1651430522694306, 2.1641503028620304, 2.0944600494858485, 2.0983245520809897, 2.0772134492599887, 2.06361966070786, 2.038297738748438, 2.0096060073453614, 2.009935383235707, 2.056249724026599, 2.013807375758302, 1.9622356964871774, 2.0040879933662663, 1.991319832770653, 1.966181363934785, 1.895346938706691, 1.9363474990807328, 1.8914023054970635, 1.9222112694596933, 1.893565259416119, 1.9175866736306084, 1.8789288366542143, 1.8705662774104699, 1.8918241282693702, 1.9170244575325959, 1.8590835198857425, 1.8727461542179382, 1.9099664518256592, 1.8524160131130343, 1.926718848203522, 1.8760927113053065, 1.8037511347166073, 1.875007775094774, 1.8159618781283011, 1.8430598746717366, 1.8248523235321046, 1.8692223626803728, 1.830994878095739, 1.8474120872472626, 1.8171111067915275, 1.8263634382509717, 1.8328833732729644, 1.7662788565641914, 1.7846703908022712, 1.7787383380279043, 1.7800282129275253, 1.8064992741042492, 1.770241908777773, 1.7994900630190482, 1.8338237234190398, 1.7411383666244207, 1.7324967039955987, 1.7756529286016827, 1.7999134052812664, 1.748063612140082, 1.7802400621713377, 1.8372349725050086, 1.7797469386867448, 1.7823873867396436, 1.770489272884294, 1.7501062189052308, 1.7191518889533148, 1.7495164557999257, 1.7943799958509556, 1.7393271396362704, 1.7705441948635126, 1.7482433850469152, 1.7346455627017552], 'val_binary_crossentropy': [0.21789968298151602, 0.16082105093142565, 0.1451013876332177, 0.1363869963031189, 0.1188821730076098, 0.1099733391131451, 0.1101494379877265, 0.1132172171489086, 0.10804394536158618, 0.11260549309206944, 0.11229324240505306, 0.11725536702699911, 0.11087451382400164, 0.10732183314957261, 0.10741704332770086, 0.1059515272285424, 0.10011984394388455, 0.11642261582846734, 0.1034370204129445, 0.10140015828161458, 0.10088078533025349, 0.1008162661972973, 0.1077942338279065, 0.1193004364281698, 0.11095627440638792, 0.10755291288974238, 0.10953919935508881, 0.10514457664464667, 0.10926233955409402, 0.0997307411364578, 0.10761501878086063, 0.10765037495350721, 0.11622807486530612, 0.10052211172391776, 0.11461478284517534, 0.11177564806432701, 0.10755059059977141, 0.11005312287053885, 0.1035098328577732, 0.11880153767959355, 0.10592401796872758, 0.11036651620361346, 0.12860273913255119, 0.11275370860353623, 0.1117581635847493, 0.11050999121789157, 0.12304628323580996, 0.11443856930469766, 0.11379195659183988, 0.1127802560203313, 0.12191037819781675, 0.11255947583236312, 0.1111684768223295, 0.10668346536972749, 0.116306010280961, 0.11675957097608011, 0.11540620467576862, 0.12234628110777075, 0.11012949409584204, 0.10482446243210385, 0.11369502756994193, 0.11757047876009559, 0.11221390910362186, 0.10490152740370165, 0.1153328219787796, 0.12417240308466812, 0.11704252905522784, 0.10997600135164415, 0.123510293681418, 0.1054758772387145, 0.12076977986699347, 0.10707894792008743, 0.11146238745004547, 0.10988531267605996, 0.11736542301593361, 0.11268581383849427, 0.11086454286066559, 0.12907098046720053, 0.11200958660444597, 0.10749001287447374], 'val_iou_score': [0.2582059453223266, 0.33910992112424637, 0.3829266107549854, 0.40702849155158, 0.4216240917545518, 0.43316580431134094, 0.4475016496442502, 0.4443157627886417, 0.4510609597746843, 0.4683160394235374, 0.4663752906754905, 0.4572198621587816, 0.472620977217855, 0.46006670633172675, 0.4798580320734604, 0.47613164585789824, 0.47915446745609147, 0.4795820209909888, 0.48069287090519675, 0.4877466828702322, 0.4890322723614624, 0.47149921546574514, 0.48657524997697155, 0.4949828505710839, 0.49011319954605664, 0.48720911900007646, 0.49266081699748443, 0.4950149614436954, 0.4968484213344412, 0.5022526212085306, 0.4987219541680579, 0.5020297782288657, 0.5022017828000137, 0.5044602558114171, 0.4932680330050537, 0.49592040978810364, 0.4841236636334775, 0.5022705332905638, 0.4982458123194626, 0.4977027816028377, 0.5015032730460947, 0.4863221768265456, 0.5040439083782676, 0.5024623204582657, 0.5058467890702042, 0.5026809267748416, 0.5020059214697944, 0.49873954980981117, 0.5007530342032707, 0.506633994567628, 0.5074346991048919, 0.506675251704805, 0.5088670637482912, 0.501729026962729, 0.5116205317716972, 0.5162590874273792, 0.5108207111849504, 0.5134578226535929, 0.513125192904784, 0.5088078597207475, 0.5073080601450665, 0.5138429424341987, 0.5123683614668504, 0.5104742122826234, 0.5135693129371194, 0.5120833060612866, 0.5108635062875312, 0.5101139489536971, 0.5104954069443778, 0.5126721731782738, 0.5037905876056041, 0.5121107315121133, 0.5109249077006882, 0.5195307534407166, 0.5231788400925842, 0.4989827610893187, 0.5131401664875691, 0.5151498634733406, 0.5117776729117811, 0.5201282487390867], 'val_edge_iou_score': [0.23755805500679547, 0.31850274303574966, 0.3632122415050962, 0.387581909238513, 0.4022741123741748, 0.41381366682403226, 0.4287092334109975, 0.42542969652640283, 0.43219675121743695, 0.45009433272617316, 0.44788856288186896, 0.43876216559628256, 0.4544095430304024, 0.44128219276861463, 0.461758824929693, 0.4579168489945484, 0.46094644874139584, 0.46167894391452596, 0.4624222582851367, 0.46978222766733013, 0.47106130382204464, 0.45284421852990747, 0.468552931539374, 0.4772349138470266, 0.47214839267574915, 0.46907872265460476, 0.4748210777449454, 0.4770448222269486, 0.4790465700470556, 0.4845675812827274, 0.48092015245381714, 0.484368113598796, 0.48456607936254553, 0.4867815813792319, 0.4753708118707114, 0.47824089994618063, 0.46573203969625265, 0.48456869616228787, 0.48032233187186596, 0.48000708613910037, 0.48369657397276516, 0.467960490042868, 0.4866982031491861, 0.48470337983252604, 0.4882668219945031, 0.4849281999606576, 0.4844510090312329, 0.48093365641207775, 0.48305102226391894, 0.48907924171758144, 0.49013369866458234, 0.48914260720174374, 0.4912727451792009, 0.4836904795736199, 0.49429269830409717, 0.4991754551340578, 0.4936084927881858, 0.49613456217715407, 0.4957557932224201, 0.4911998626064193, 0.4897784389315532, 0.4965908490949228, 0.49489656870067206, 0.49290880707019913, 0.4962254055186537, 0.4947747476554189, 0.4934336522827421, 0.4926124183376887, 0.49307002781653675, 0.49515223257688945, 0.48596542911987745, 0.49462299393684267, 0.4934830031371178, 0.5022443579701885, 0.5062428504424322, 0.48113925860364665, 0.4957985851706324, 0.4979900586450358, 0.49439611690122703, 0.5028879366279788], 'val_mask_iou_score': [0.7744029324818281, 0.8542890791799508, 0.8757855180042242, 0.8931926688337638, 0.905373218012791, 0.9169687785354315, 0.9173116155699188, 0.9164670047417186, 0.9226658068451227, 0.9238581755582024, 0.9285429765975554, 0.9186618518206029, 0.9279063681371851, 0.9296790443993861, 0.9323377853904674, 0.9315011510662005, 0.9343544490197125, 0.9271585439544877, 0.9374577452154721, 0.9368575625949436, 0.9383059854600944, 0.9378736516229468, 0.9371327688491422, 0.9386808039316165, 0.9392329449747123, 0.9404686143974853, 0.9386538751764235, 0.9442679367813409, 0.9418941887375576, 0.944378144444983, 0.9437665562224544, 0.9435709543477476, 0.9430939287921183, 0.9464265690909491, 0.9406981010063021, 0.9379076892254399, 0.9439137719035928, 0.9448159256791757, 0.9463323507433623, 0.9400947556776159, 0.9466702802508485, 0.9453638405581705, 0.9376860609241561, 0.9464354586757087, 0.945345476483987, 0.9464985811632443, 0.9408782355925616, 0.9438864459399304, 0.9433028554604723, 0.9455024198768964, 0.9399591749010522, 0.9449908349249098, 0.9487246108210944, 0.9526923550499811, 0.9448158563352098, 0.9433494273354025, 0.9411256949106852, 0.9465387804056304, 0.9473596784803603, 0.9490073308446049, 0.9455481487161973, 0.9451447732308331, 0.9491627252179813, 0.9496088610755072, 0.9471664355471243, 0.9447967413983314, 0.946609331112282, 0.947651767886542, 0.9461294212372474, 0.9506702070921854, 0.9494191465814129, 0.9493037720131718, 0.9469720318426493, 0.9516901062984092, 0.9465781062257056, 0.9450697866140627, 0.9466792178309821, 0.9441444845760569, 0.9463160703384799, 0.951135631324419], 'val_deviation': [3213.9492578201043, 2605.533333388497, 2054.1768846784544, 2251.522853582747, 1275.144005668397, 1318.0484768299495, 1617.1644032839076, 2085.6746142102224, 1530.631805123301, 1768.010638346937, 2017.0756287881752, 1662.8295133960792, 1525.3516199698636, 1372.5754471042576, 1442.9335798041493, 1619.2272230149874, 1358.9015229813804, 1813.587203179855, 1226.3071988908684, 1464.7474255039801, 1263.0996890178692, 961.3779681548574, 2092.836842291476, 1708.6999466817754, 2060.6422118913115, 1691.6929625924895, 1560.3634683846258, 1163.4220553312816, 1704.865321508459, 1282.8685148028767, 1400.1826466191437, 1396.7713312117298, 1781.1089445222046, 1290.7912544388398, 1260.5951803357773, 1593.081482897358, 1097.970699844602, 1271.7724167079318, 1014.1906693531602, 1857.7673826381076, 1076.8098750540244, 1393.2270673298954, 1845.753006669762, 1525.5424949487244, 1701.5428499143497, 1141.2011654175185, 1607.0925320324945, 934.4177275723491, 1623.027769547506, 1250.3832987737617, 1789.253107768531, 1398.6400994977334, 1600.2845552956942, 1050.0366662540077, 1388.9106436352715, 1715.359915702717, 1394.1207347985967, 1495.36188728038, 1238.011358798524, 829.8288082029695, 1044.0796799309699, 1336.4141902648546, 814.4951168312357, 1124.1044005038498, 1421.5526716415593, 1515.379806979653, 1418.3268745539624, 1010.9732902135335, 1495.9239377277738, 930.3792431290437, 1110.4514080371343, 978.0085748299664, 1123.5228087279336, 1223.1633822560311, 1252.354132590029, 1126.6143953341868, 914.6875238141008, 1754.8090422939242, 1073.6997006588317, 1125.0965653404496], 'loss': [3.0619166660606862, 2.141261813879013, 1.8693725664317609, 1.705481196075678, 1.5861084660589695, 1.488479168444872, 1.4088849611580372, 1.337920498251915, 1.2751922766417265, 1.2202007203400136, 1.1763508614897729, 1.1342829104959964, 1.097599316343665, 1.0658210507780312, 1.0359892296791076, 1.0080622414797544, 0.982782326117158, 0.9639170363843441, 0.9407673031538725, 0.9226705420017243, 0.9060630354583263, 0.8913641120046377, 0.8783130730837584, 0.8647288527041673, 0.8495604197233916, 0.8370752907842398, 0.8286135286390781, 0.8203908859789372, 0.8070505104511976, 0.798001926407218, 0.7919448929429054, 0.780924035474658, 0.7748158212155104, 0.7665281172990799, 0.7583229728043079, 0.75251641446352, 0.7457907176911831, 0.7393586125224829, 0.7334835893511772, 0.7287226470708847, 0.7228514105975627, 0.7174652775973082, 0.7121048881858587, 0.7078022545576096, 0.7033995795100927, 0.6984752554148436, 0.693520548954606, 0.6915850370526314, 0.687107894167304, 0.6826950847953558, 0.6799835844039916, 0.6729277877956629, 0.671786538913846, 0.6695987563803792, 0.6656087200194597, 0.6627077794000507, 0.6586216579526663, 0.6550622909963131, 0.6524002960771322, 0.651971770055592, 0.6465544896051287, 0.6432485453635454, 0.6437062239944935, 0.6401511710286141, 0.6348856671079993, 0.6350374496504665, 0.6310729977115989, 0.6311011358052492, 0.627726449497044, 0.6244698716774583, 0.6227396769225597, 0.6206931517720222, 0.6187439586594701, 0.6153635088652373, 0.6160968278050423, 0.6152552065402269, 0.6093318611904979, 0.6072943865582346, 0.6077402639612556, 0.604416238233447], 'binary_crossentropy': [0.3402648936919868, 0.2032181402016431, 0.1562347468454391, 0.13459686580579727, 0.12002788158785552, 0.10895916246436536, 0.10079660074785352, 0.09415951671451331, 0.08792787637049332, 0.08345677572116256, 0.08016896479483694, 0.07559928110381588, 0.07301807614183053, 0.07022474890574813, 0.06852916847309097, 0.06643670650059358, 0.06350319731794297, 0.06267665497213602, 0.060126870793756095, 0.05916616236977279, 0.05786047672526911, 0.0568216680935584, 0.05627633360726759, 0.05445799046847969, 0.05282312930934131, 0.052103729740250855, 0.05178056016471237, 0.05090855432581157, 0.049825875892769544, 0.04886158088641241, 0.04930977906985208, 0.04755398648139089, 0.04758215448679402, 0.04659133050218225, 0.04579274924192578, 0.04571661218907684, 0.04486240707384422, 0.04448472891468555, 0.043888265368063, 0.04338525021634996, 0.04280209082597867, 0.04259807408647612, 0.04206864112336189, 0.04207585963862948, 0.041342283972073346, 0.0407303995359689, 0.04064774612756446, 0.04027804180933162, 0.04028499777708203, 0.03950349243101664, 0.04030987621052191, 0.03885889925528318, 0.0387377888658084, 0.03879481062409468, 0.038389090554323047, 0.038257056007627396, 0.03738844157732092, 0.037697533540660515, 0.0372132238438353, 0.03721251354785636, 0.036656741615151985, 0.03662359517836012, 0.036675526638049634, 0.03610329967411235, 0.035717113603372125, 0.035925223133526744, 0.03607262948108837, 0.035470951390452685, 0.03537117743864655, 0.03558914442779496, 0.03485384419606999, 0.034536311769858004, 0.0349455502720084, 0.03411852753162384, 0.0345610323548317, 0.03466411202773452, 0.03374270902830176, 0.033612913050455974, 0.03355467240116559, 0.03343775932397693], 'iou_score': [0.16570717686135322, 0.31187489343993363, 0.38154037058353424, 0.4235250390917063, 0.45211107517033816, 0.4750175949372351, 0.49268462631106374, 0.5089445224367082, 0.5231181706041098, 0.5358530386239291, 0.5449063706398011, 0.5543813226744533, 0.5627320804335177, 0.5695172934532166, 0.5765755908191204, 0.5836489551216364, 0.5896553199104965, 0.5934194505438208, 0.5998259768784047, 0.6042362825199962, 0.6083574377372861, 0.6122148079499602, 0.6151843497678637, 0.6188122240379452, 0.6233985762670636, 0.6270998427197337, 0.6288882565498352, 0.6308612999394536, 0.6355521568283439, 0.6383055659085513, 0.639786087937653, 0.6434273536652326, 0.6449204584732652, 0.6477354929819703, 0.6505103205144406, 0.6521046625077724, 0.6544585740864277, 0.6564610611274838, 0.6584671449959278, 0.6598375264033676, 0.6619176605567336, 0.6638594741523266, 0.6655941970199346, 0.6672668071910739, 0.6687078636288643, 0.6703579190522432, 0.6722691234126688, 0.67229336989671, 0.674213855534792, 0.67574601110816, 0.676880093427375, 0.6794916172176599, 0.6793612738102675, 0.680123949110508, 0.6817688563168048, 0.6831716452315449, 0.6842269643768668, 0.6857705946862698, 0.6867159786894917, 0.6866891471445561, 0.6893365041539073, 0.6903196788057685, 0.6899585699066519, 0.691058463215828, 0.6939053949862719, 0.6931845053061843, 0.6950530568808317, 0.6942940136045217, 0.6962169110104441, 0.6976914828270674, 0.6976938456073404, 0.6989362455904484, 0.6992603635042905, 0.7010658841133117, 0.7003023659139872, 0.7008162469416856, 0.7031452373489737, 0.7038679626137018, 0.7036239853128791, 0.7053481425717473], 'edge_iou_score': [0.14584447846817783, 0.29248643236979843, 0.36271075171604755, 0.4053047759309411, 0.4344123785234988, 0.45775168876722455, 0.47577379340305925, 0.4924067551381886, 0.5068994164541364, 0.5199680172689259, 0.5292354101538658, 0.5389227144345641, 0.547492778390646, 0.5544435986727476, 0.5617201370447874, 0.5689954007416964, 0.5751281051784753, 0.5790115328654647, 0.5855736031904817, 0.5901261660605669, 0.5943627583235502, 0.5983327100537718, 0.6013999986052513, 0.6051051521897316, 0.6098144558146597, 0.613639561533928, 0.6154706121832132, 0.6174974617809057, 0.6223384594134986, 0.6251624207273125, 0.6267220111042261, 0.6304385747164488, 0.63199554181844, 0.6348993050307036, 0.6377446487769485, 0.6394011395573616, 0.6418248124420642, 0.6438864352032542, 0.6459622431844473, 0.6473507084846497, 0.6494992115721107, 0.6515108027830719, 0.6533013672977686, 0.6550385249778629, 0.6565150752440095, 0.6582162903100253, 0.6601922778636217, 0.6602083974406123, 0.6621974973902106, 0.6637682265713811, 0.6649692278336734, 0.6676455437615514, 0.6675109070986509, 0.6683008781746029, 0.6700007820501923, 0.6714537942260503, 0.6725165395140648, 0.6741354523971677, 0.6751059534624219, 0.6750770361274481, 0.6778097842410207, 0.6788292434737087, 0.6784595184400678, 0.6795880367681384, 0.682531327329576, 0.681790113762021, 0.6837398206666112, 0.6829307390972972, 0.684918849080801, 0.6864633342474699, 0.6864445228204131, 0.6877219366878271, 0.6880739350691438, 0.6899221000000835, 0.6891531695052981, 0.6896872649714351, 0.692076804690063, 0.6928208127766847, 0.6925709726065398, 0.6943662547692656], 'mask_iou_score': [0.6622744755893946, 0.7965861119329929, 0.8522804746478796, 0.8790312175303697, 0.8945780581235886, 0.9066647922843695, 0.9154549780637026, 0.9223882160335779, 0.92858653190732, 0.9329780522882939, 0.9366798303723335, 0.9408459889888764, 0.943714091643691, 0.9463591164052486, 0.9479613549858331, 0.9499872563481331, 0.9528351054787636, 0.9536168339252472, 0.9561347350776196, 0.9569886214733124, 0.9582238230854273, 0.9592666392177344, 0.9597925320714712, 0.9614884190410375, 0.9630009973049164, 0.9636062646359205, 0.9643287592828274, 0.964956663325429, 0.9658939764797687, 0.9668835910707713, 0.9663874024450779, 0.9681462087035179, 0.9680427573174238, 0.9686395745426416, 0.969651488557458, 0.9696920832693576, 0.9703019599169492, 0.970826047718525, 0.9710890621840954, 0.9720073377341032, 0.9723782483190299, 0.9725756161361933, 0.9729142837822438, 0.9729732257425785, 0.9735269303023815, 0.9738979947566986, 0.9741896039247513, 0.974417045161128, 0.9746221429556609, 0.9751899584531784, 0.9746511042565107, 0.9756427702307701, 0.9756197922825813, 0.9757000514268875, 0.97597005712986, 0.9761172622591258, 0.9769869100749493, 0.9766485060453415, 0.9769659506231546, 0.9769912735968829, 0.9775038446485996, 0.9775798862278462, 0.9774341724365949, 0.9778184584230185, 0.9782564243674279, 0.9780436231344938, 0.9778832649737597, 0.9783751708716154, 0.9786677879840135, 0.9783945156931877, 0.9789262177199125, 0.9792932871878147, 0.9789203719496727, 0.9796598081290722, 0.979031623005867, 0.9790401154607534, 0.9798553801625967, 0.98004605679214, 0.9799486268907786, 0.9798946602940559], 'deviation': [1487.1380536581873, 1358.789771311477, 1263.3088631299436, 1188.465479272723, 1138.4629979911595, 1034.7564788583368, 1028.559710006334, 960.1135808827617, 928.5559092509151, 884.8480861696899, 860.9273809384704, 794.9912879455946, 767.834437276937, 715.3934804581329, 686.4379377552383, 683.5136047365219, 620.3831283610463, 610.7664676332474, 569.1116600318402, 531.5534715858419, 533.25920764089, 530.4060416469612, 519.9361021335442, 461.58067638566905, 424.3354658668246, 434.017342632873, 428.20070425214806, 413.4383262288608, 384.1906106033865, 370.27748293008096, 392.5601940934714, 367.7579962935392, 369.700993764814, 350.581678676622, 300.15030461517534, 308.9166786978729, 315.99664641257374, 296.17387545833367, 307.941265256403, 280.7978457453921, 287.78030977852086, 263.22093368071876, 265.6391063566394, 253.21486866637133, 249.3490388422571, 235.62417189449818, 236.94544006523304, 243.91041799295135, 218.9973684408702, 234.16100816475227, 253.0939383891523, 206.36309807404317, 212.95024464438856, 227.1964182367865, 216.26878068929352, 213.92684509535133, 185.35232695306465, 207.89793297536485, 194.49025743483566, 194.99018952757305, 183.38579728784225, 185.13306542423928, 186.54291748806276, 174.6842616691701, 171.58376252078824, 168.61855142380855, 191.1444068199396, 166.08419916374237, 170.3957039838359, 180.1117253966909, 169.0510372458976, 154.66950016503037, 166.7927855763305, 154.18050930367968, 152.04349406116827, 159.72919142493046, 138.3679862925615, 148.69553873552567, 137.88627899741567, 134.75165732495114]}
	
	
	for key, values in history.items():
		if not 'val' in key:
			plt.figure(key)
			plt.plot(values)
			plt.plot(history['val_' + key])
			plt.show()
		